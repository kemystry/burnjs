(function(){var Burn,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Burn=function(){function Burn(){}return Burn.adapters={},Burn.controllers={},Burn.models={},Burn.views={},Burn.currentController=null,Burn.resourceHost="",Burn.registerController=function(controller){var name,ref,results,route,routePath;this.router=this.router||new Burn.Router,this.controllers[controller.name]=controller,ref=controller.prototype.routes,results=[];for(route in ref)name=ref[route],routePath=route+"(/)",results.push(Burn.router.registerRoute(routePath,name,controller));return results},Burn.layout=function(layout){return _.isString(layout)?(this.currentLayout=new Burn.Layout,this.currentLayout.template=layout):layout instanceof Burn.Layout&&(this.currentLayout=layout),this.currentLayout.render(),this.currentLayout},Burn.start=function(){return this._initConfig(),this._initAdapters(),Backbone.history.start()},Burn._initAdapters=function(){return rivets.adapters[":"]=Burn.adapters.BackboneRelational()},Burn._initConfig=function(){var config;return config={prefix:"brn",preloadData:!0,rootInterface:".",templateDelimiters:["{","}"],handler:function(target,event,binding){return this.call(target,event,binding.view.models)}},rivets.configure(config)},Burn}(),self.Burn=Burn,Burn.adapters.BackboneRelational=function(){var _factory,_getter,_setter;return _factory=function(action){return function(model,keypath,callback){var eventName,value;if(model instanceof Burn.Model){if(value=model.get(keypath),eventName="*"===keypath?"change":"change:"+keypath,model[action](eventName,callback),value instanceof Burn.Collection)return value[action]("add remove reset sort",callback)}else if(model instanceof Burn.Collection&&"models"===keypath)return model[action]("add remove reset sort",callback)}},_getter=function(obj,keypath){var value;return obj instanceof Burn.Model?(value="*"===keypath?obj.attributes:obj.get(keypath),value instanceof Burn.Collection&&(value=value.models)):obj instanceof Burn.Collection&&(value=obj.models),value},_setter=function(obj,keypath,value){return obj instanceof Burn.Model||obj instanceof Burn.Collection?"*"===keypath?obj.set(value):obj.set(keypath,value):void 0},{observe:_factory("on"),unobserve:_factory("off"),get:_getter,set:_setter}},Burn.Router=function(superClass){function Router(){return Router.__super__.constructor.apply(this,arguments)}return extend(Router,superClass),Router.prototype.registerRoute=function(path,name,controller){var callback;return callback=function(){var arg,ctrl,i,len,match,params,re;if(ctrl=Burn.currentController=new controller,params={},arguments.length>0)for(re=/:([a-zA-Z0-9_\-]+)/g,i=0,len=arguments.length;len>i;i++)arg=arguments[i],_.isNull(arg)||(match=re.exec(path),params[match[1]]=arg);return ctrl.runBeforeFilters.apply(ctrl,[params,path,name]),ctrl[name].apply(ctrl,[params]),ctrl.runAfterFilters.apply(ctrl,[params,path,name])},this.route(path,name,callback)},Router}(Backbone.Router),Burn.Controller=function(){function Controller(){}return Controller.prototype.routes={},Controller.prototype.beforeFilters={},Controller.prototype.afterFilters={},Controller.prototype.runBeforeFilters=function(params,path,name){return this.runFilters(name,this.beforeFilters)},Controller.prototype.runAfterFilters=function(params,path,name){return this.runFilters(name,this.afterFilters)},Controller.prototype.runFilters=function(name,filters){var action,opts,results,run;run=!1,results=[];for(action in filters)opts=filters[action],"all"===opts?run=!0:opts.only&&-1!==opts.only.indexOf(name)?run=!0:opts.except&&-1===opts.except.indexOf(name)&&(run=!0),run?results.push(this[action].apply(this,[name])):results.push(void 0);return results},Controller}(),Burn.Model=function(superClass){function Model(){return Model.__super__.constructor.apply(this,arguments)}return extend(Model,superClass),Model.prototype.url=function(){var path;if(!this.resourcePath)throw new Error(this.constructor.name+" must specify a resourcePath");return path=_.isFunction(this.resourcePath)?this.resourcePath():this.resourcePath,Burn.resourceHost+"/"+path},Model}(Backbone.RelationalModel),Burn.Collection=function(superClass){function Collection(){return Collection.__super__.constructor.apply(this,arguments)}return extend(Collection,superClass),Collection.prototype.url=function(){var path;if(!this.resourcePath)throw new Error(this.constructor.name+" must specify a resourcePath");return path=_.isFunction(this.resourcePath)?this.resourcePath():this.resourcePath,Burn.resourceHost+"/"+path},Collection}(Backbone.Collection),Burn.Layout=function(){function Layout(){}return Layout.prototype.template=null,Layout.prototype.containers={},Layout.prototype.render=function(){var mainContainer;return mainContainer=$("[brn-app]").first(),mainContainer.text(this.template)},Layout}(),Burn.View=function(superClass){function View(){return View.__super__.constructor.apply(this,arguments)}return extend(View,superClass),View.prototype.beforeRender=function(){},View.prototype.afterRender=function(){},View.prototype.beforeDestroy=function(){},View.prototype.afterDestroy=function(){},View.prototype.loadTemplate=function(){return $.get(this.template)},View.prototype.render=function(){return this.$el.addClass(this.constructor.name),this.beforeRender(),this.loadTemplate().then(function(_this){return function(tpl){return _this.$el.html(tpl),_this.__rivets__=rivets.bind(_this.el,_this),_this.afterRender()}}(this)),this.el},View.prototype.destroy=function(){return this._beforeDestroy&&this._beforeDestroy(),this.parent=null,this.__rivets__.unbind(),delete this.__rivets__,this.remove(),this.afterDestroy()},View}(Backbone.View)}).call(this);